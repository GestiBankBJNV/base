<div class="main-content" >
    <div class="container-fluid">
    	
		<div class="row">
            <div class="col-md-8">
                <div class="card">

                	<div class="header">
						<h3>Gestion des affectations</h3>
					</div>

					<div class="content">
						
								<!-- TODO : pb quand page rétrécie, + p15 -->
								<div class="row">
									<div class="col-md-8">
										<h4>Liste des demandes d'ouverture de compte</h4>
									</div>

									<div class="col-md-3 col-md-offset-1">
										<!-- Filter les demandes affectées ou non. TODO : mieux placer le dropdown dans la page -->
										<div class="dropdown">
											<button class="btn dropdown-toggle" type="button" data-toggle="dropdown">
												Filtrer les demandes
												<span class="caret"></span>
											</button>
											<ul class="dropdown-menu" role="menu">
												<li role="presentation"><a role="menuitem" tabindex="-1" (click)='recupTable()'>Toutes les demandes</a></li>
												<li role="presentation" class="divider"></li>
												<li role="presentation"><a role="menuitem" tabindex="-1"  (click)="filtrerDemandes('nonAffectee')">Demandes non affectées</a></li>
												<li role="presentation"><a role="menuitem" tabindex="-1" (click)="filtrerDemandes('affectee')">Demandes affectées</a></li>			
												<li role="presentation" class="divider"></li>
												<li role="presentation"><a role="menuitem" tabindex="-1" (click)="filtrerDemandes('enCours')">En cours</a></li>
												<li role="presentation"><a role="menuitem" tabindex="-1" (click)="filtrerDemandes('traitee')">Traitée</a></li>												
											</ul>
										</div>
									</div>
									
								</div>

								<div class="content table-responsive table-full-width">
							        <table class="table">
							                <thead>
							                    <tr>
							                      <th>Prénom</th>
							                      <th>Nom</th>
							                      <th><a (click)='trierDateDemande()'>Date de demande</a></th>
							                      <th><a (click)='trierDateAffectation()'>Date d'affectation</a></th>
							                      <th>Statut</th>
							                    </tr>
							                </thead>
							              <tbody>
							                  <tr *ngFor="let demande of tableData">
							                      <td>{{ demande.coordonnees.prenom }}</td>
							                      <td>{{ demande.coordonnees.nom }}</td>							                      
							                      <td>{{ demande.date | date:'dd/MM/yyyy'}}</td>
							                      <td>{{ demande.dateAffectation | date:'dd/MM/yyyy'}}</td>
							                      <td>{{ demande.statut }}</td>
							                      <td><button *ngIf="demande.dateAffectation == undefined" (click)="affect(demande)" class="btn btn-danger btn-xs">Affecter</button></td>
							                      <!-- <td class="td-actions text-right">
							                          <a rel="tooltip" title="Affecter demande" class="btn btn-info btn-simple btn-xs" (click)="affect('client')"> 
							                              <i class="fa fa-user"></i>
							                          </a>
							                          <a rel="tooltip" title="Modifier Affectation" class="btn btn-success btn-simple btn-xs" (click)="modifier=true">
							                              <i class="fa fa-edit"></i>
							                          </a>
							                          <a rel="tooltip" title="Supprimer" class="btn btn-danger btn-simple btn-xs">
							                              <i class="fa fa-times"></i>
							                          </a>
							                      </td> -->
							                  </tr>
							              </tbody>
							        </table>
							    </div>
							    
					</div>

					<!-- A afficher si on clique sur le bouton dans le tableau -->
					<div *ngIf="(affecter)">
						<div class="header">
							<h4>Associer la demande au conseiller : </h4>
						</div>

						<div class="content">
							<div class="row">
								<div class="col-md-5">
									<div class="form-group">
										<input type="text" value="" placeholder="Conseiller" class="form-control" [(ngModel)]="conseillerRecherche" (keydown.enter)="clicRechercher()"/>
										<button type="submit" class="btn btn-info btn-fill pull-right" (click)="clicRechercherConseiller()">Valider</button> 
									</div>
								</div>				
							</div>
						</div>
					</div>					

					<!-- Recherche les conseillers compatibles -->
                	<div class="header" *ngIf="(isSearching)">
						<h4 *ngIf="isLoading"><i>Recherche conseillers ... </i></h4>
						<h4 *ngIf="!isLoading">Selectionner le conseiller :</h4> 
					</div>

					<div class="content" *ngIf="(isSearching)">

						<div class="row">
							<div class="col-md-12">									

								<nav>
									<a *ngFor="let conseiller of conseillers | async" (click)="select(conseiller)"><p>{{ conseiller.matricule }} : {{conseiller.prenom}} {{conseiller.nom}}</p></a>
								</nav>
								
							</div>
						</div>
						
					</div>

				</div>
			</div>
		</div>

	</div>
</div>